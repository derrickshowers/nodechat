<head>
  <title>Little node.js chat test</title>
  <script src="/socket.io/socket.io.js" ></script>
  <script>

    // check url to serve correct server url
    var serverAddress;
    if (document.URL.indexOf('localhost') > 0) {
      serverAddress = 'http://localhost:8080';
    } else {
      serverAddress = 'http://dsnodechat.herokuapp.com/'; 
    }
    var server = io.connect(serverAddress);
 
    // DOM manipulation
    var insertText = function(text) {
      
      var newText = document.createElement('li');
      newText.innerHTML = text;

      var allText = document.getElementsByTagName('ul')[0];
      return allText.appendChild(newText);

    }

    server.on('text', function(data) {
      console.log('server.on callback called');
      insertText('Someone else: ' + data);
    });

  </script>
</head>

<body>
  <input name="message" placeholder="Enter your message"/>
  <button type="submit">Send it away!</button>
  
  <ul></ul>
  <script>
    
    // Listen for submit
    document.getElementsByTagName('button')[0].addEventListener('click', function(e) {
      e.preventDefault();
      var messageText = document.getElementsByTagName('input')[0].value;
      server.emit('text', messageText);
      insertText('Me: ' + messageText);
      document.getElementsByTagName('input')[0].value = "";
    });

  </script>

</body>

</html>
